# 数字设计复用方法论手册

用于SOC设计 第三版

作者：Michael Keating- Synopsys，Inc  & Pierre Bricaud- Synopsys，Inc

译者：Luukie & LOSKH & 台灯

#前言
	
	半导体行业已经进入到单芯片数百万门级的规模，而且门级的规模只会越来越多，不会逆转。Sematech预测，到2001年最先进的集成电路将超过1200万门，运行速度超过600M，这样量级对于一个每天设计100个门的工程师需要工作500年才能完成。正阳做消耗的劳动力时间太长，成本也太高。但是1200万门的设计很快就会出现。
	
	我们要怎么达到这个目标呢？无论涉及到什么样的解决方案，有一件事情是明确的：通过对设计（IP）的重新利用将会是解决生产力问题的不变基石。可重复利用的IP保障了项目的质量和效率如果没有重用，半导体行业将无法提供给消费者 更好更快更便宜的片子。
	
	Synopsys和Mentor已经开始参与并主导帮助IP重利用成为现实。我们设计重利用联盟的一个目标便是：开发演示并文档化一种有效的重用设计方法，本书便是这一目标的产物。它结合了Synopsys和Mentor的经验和资源。Synopsys在设计重用工具上更加专业而Mentor在IP创建和采购（？）方面更有优势，双方合作完成了这篇方法论。本文描述了我们发现的最佳可重用的设计以及将其集成到大型芯片中的方法。
	
	我们希望这套面向高级IC设计者的手册可以成为全行业的基础，可以加速对于重用设计的采用并可以对未来大型复杂芯片的快速开发有促进作用。
	
##第三版序
	自三年前的第二版出版以来，芯片设计已经发生了重大的变化，这段时间里，已经有两代硅农先后嗝屁。百万门级的设计现在也遍地开花，什么阿猫阿狗都能混个IC前端当当。
	
	同时，重用设计这边也发生了不小变化，所以我们出版了这一版，修复之前写的那些BUG。
	
	我们的预言真是屌，现在大家都在用我们这套方法论了，我们也不装了，我现在不是建议你们要这么设计，而是你们就得这么设计。这一版里面老子要好好教教你们到底怎么写代码。
	
	这一版爷改了挺多的内容的，没办法，时代在变化。
	
	2002年。

#第一章-简介
如今的半导体技术允许我们制造出单芯片上可承载数以亿计个晶体管，这项技术使得我们已经可以做到在单芯片上集成系统级应用，同时也彻底改变了芯片设计的方式。市场对于性能更强产品的渴望和现今硅技术可实现的巨大规模，使得SOC设计逐渐成为主流。这类芯片在单片上通常拥有一至多个处理器，大量的内存，基于总线的架构，外围设备，协处理器以及Ｉ／Ｏ。

由于芯片的改变，对于芯片的设计方法也必须做出改变，以前那种通过从头编写所有RTL设计芯片，集成RTL模块到顶层，然后跑综合实现的方式不再适用于设计大型复杂的芯片，对已经预先已经设计并验证好的模块进行重利用才是现在SOC设计的基石，因为他是唯一的可以使得大型芯片的设计成本可以接受的方法，这些成本包括设计团队的规模，项目的进度以及最终成品的质量。设计师们需要考虑的不在是是否使用设计重用，而是如何高效的使用设计重用。

这本手册简述了一整套用于SOC设计中编写可重用设计的最佳方法。这些方法是基于我们自己在项目中设计可重用模块时候的经验，也包括了全世界其他地区许多的设计团队的经验。半导体和EDA技术发展的如此之快，对于可重用设计的细节已在不断变化。但是本手册中所描述的方法均是已被广泛采用并大概率在未来成为芯片设计的基础。

##1.1本手册的目标
系统设计者，处理器设计者，DSP设计者和芯片工艺设计者（chipset designer是啥？）之间拥有各自不同的开发方法。然而，大家都面临着一系列相同的问题：
	* 将产品今早推向市场需要快速的研发
	* 性能面积和功耗上的优化是赢得市场的关键
	* 随着芯片复杂度的提升，验证变得越来越困难
	* Deep Submicron（？）问题使得时序收敛变得困难
	* 开发团队的成员水平不一而且可能身处世界各地
	* 设计团队成员之前可能做过类似的设计，但是由于设计流程，工具以及设计参考的改变导致并没有办法将其重用
	* SOC设计包含了嵌入式处理器内核这一重要的软件组件，这将在设计方法学，流程以及组织方式上带来额外的挑战

为了应对这些问题，设计团队采用了基于成熟IP的设计方法学，强化了设计的重新利用。重用已经被仔细设计并精心验证过的模块有助于解决上述问题。然而如果重用的模块没有提供正确的文档和功能说明，那么重用这种模块反而会起到反作用。

基于这种踩坑经验，设计团队意识到需要开发一套明确的方法学来规范可重用设计，本手册着重于描述这套方法学，包括：
	* 可重用设计如何适应SOC的开发
	*  如何设计可重用软宏（应该就是可重用的RTL代码？）
	* 如何基于软宏设计可重用硬宏（网表？）
	* 软宏/硬宏如何继承到SOC中
	* 如何在大型的SOC设计中验证其时序与功能

这样，这本手册可以解决两种工程师的问题：一个是可重用模块的设计者，另一个是将可重用模块集成到大型设计中的人。对于设计可重用模块的人来说，他们感兴趣的部分是如何设计软宏并将其转化为硬宏。对于做集成的人来说，同样宏设计这部分他们主要关注在重用设计中应该寻找什么。

由于深亚微米的发展使得SOC设计成为可能，但设计大规模SOC仍然有一系列的挑战，包括互联延迟，时钟与功耗分配，以及数百万门电路的布局布线。这些物理设计问题可能会对SOC的功能设计和设计过程本身产生重大影响。内部互联，引脚布局以及时序设计都必须在设计的早期进行，同制定功能需求一起进行。本手册着眼于逻辑设计的稳健性问题，使得设计在制造时可以满足时钟速率，功耗与面积的要求。

SOC设计出了硬件本身之外，还需要考虑软件部分。但是本手册重点在于硬件设计，软件的可重用设计同样重要，只是本手册不涉及。

###1.1.1  预备知识
本手册需要以下预备知识或技能：
	* HDL设计以及综合
	* DFT，包括full-scan技术
	* 布局布线，物理综合，引脚布局

###1.1.2 术语
Macro_Core_Block/IP在本文中都是一个意思。
其余的术语：
	* 子模块：IP的下级模块，太小或功能太特定而单独拎出来做为一个子模块
	* 软宏：由可综合RTL代码构成的可重用设计
	* 硬宏：GDSII文件构成的可重用设计，已经被完整的设计并布局布线。

###1.1.3 虚拟套接字接口联盟（VSIA）
VSIA是一个行业组织，通过为工具接口，设计以及文档定制标准来推进大家对设计重用的接受度。VSIA在提高行业对设计重用的重要性认识以及抓住行业在使用设计重用过程中遇到的关键问题方面做出了重要贡献。

VSIA已经制定了一些目前正在审核的标准建议，本手册试图遵守这些建议。

但是有一些建议这里没有遵守：
	* 虚拟组件：VSIA建议将IP改名叫虚拟组件，我们没有。
	* 固宏：处于软宏与硬宏中间的一种形态，可以是RTL代码或者是网表形式，本手册不涉及本形式的可重用设计，只专注于软宏和硬宏

##1.2 可重用设计的挑战
可重用设计的前提是可用，设计本身需要正确且稳健，这需要：
	* 好文档
	* 好代码风格
	* 通俗易懂的注释
	* 易用的仿真环境和套件
	* 稳定的脚本

学校里已经教学了年轻的工程师们这些事情（并没有教），但是在面对项目压力的时候，他们通常并不会按部就班的完成这些。绕过这些要求似乎可以加速设计的进度，但是其实只是将这部分工作从设计阶段转移到集成阶段。遵守这些良好的设计流程和习惯似乎在一开始的时候是一种没有必要的负担。但是这样做的好处是可以减少重复编写设计和验证代码，从而加快了项目的设计，验证以及debug过程。

###1.2.2 让设计变得可重用
除了设计的正确与稳定外，如果想要可重用，那么设计还需要一些额外的要求：
	* 解决普遍的问题：这通常意味着设计需要根据不同的使用情况提供一些可配置选项
	* 用于多种技术（？）：
	* 适配不同的仿真环境：设计的testbench需要支持市面上主流的仿真器，若有必要，则对每个模块提供并维护VHDL和verilog两个版本的testbench。
	* 使用市场上成熟的标准协议作为接口：非必要，不开发自定义接口。
	* 可独立验证：即使不接入设计模块未来需要集成进的总框架中，模块的功能依然可以被非常高覆盖率的测试验证，为此需要提供专属于该模块独立的testcench和仿真套件。
	* 充分的验证：通常需要进行非常严格验证，并在FPGA原型验证机上实现和软件进行联合验证。
	* 提供文档记录可配置值的推荐以及可用范围：文档需要提供有效的配置和参数值，如果配置或参数值有任何限制都需要说明。需要记录使用模块时的接口要求和约束。

这些要求提高了开发模块的工作量，但是也同时提高了设计的可重用性。

##1.3 可重用设计的商业模式
这些年，可重用设计的商业模式变化也很快，催生出有许多不同的问题：
	* 所有的设计者要对所有的设计都考虑可重用性吗？
	* 如何激励设计团队做出可重用的设计？
	* 只做一部分设计可重用设计的考虑，我们管它叫临时可重用，这样的设计有什么意义吗？
	* 那些模块应该内部开发？那些模块应该外部购买？

这些问题大部分都可以在社区找到答案。

第一个结论是使用临时可重用设计可以提供2到3倍的益处，也就是说使用临时可重用设计可以花费从头设计所需要时间的二分之一或者三分之一就可以完成同样的功能。但是这种幅度的提高不足以支持SOC的设计，大多数SOC的设计要求大部分模块都是完全可重用的。

对于一个优秀的设计师来说，它可以以平均每天100门的速度完成设计，这大致等同于每天10个30行的RTL代码，而一个典型的20世纪90年代的ASIC大致有10万门的规模，这就需要1000个设计师日，而对一个1000万门的设计，则需要10万设计时日，这意味着即使有一个500人规模的设计师团队也需要一年的时间才能完成设计，就算是使用临时可重用设计提高了二到三倍的设计速度，也是一个大多数人和企业无法接受的成本。

因此，现在公司们对于SOC项目，采用了明确的可重用设计方案。

第二个结论是，明确的可重用设计需要一个专门的团队。开发特定功能模块的设计者不会做出可重用性的兼容，设计一个可重用的模块比设计一个单一功能的模块要费时得多。芯片设计师的工作通常繁重并且项目进度紧张，所以他们在实际项目中的设计标准是能用就行，所以公司需要建立一个内部的研发小组专门用来做可重用升级。

因此，绝大多数可重用设计来自专门的内部团队或者第三方IP供应商。

第三个结论是，开可重用设计非常昂贵。在本手册的第一版中，我们说将一个模块设计为可重用的版本比设计成一次性使用的版本在成本上要贵二到三倍。我们现在认为这个倍数有些低了。要实现功能的完整验证，维护文档的完整性还有其他使得该设计可以稳定重用需要付出的工作绝不止三倍。对于一个小模块来说，可能是10倍，而对于一个大型的SOC来说，还要在提升一个数量级。

出于这个原因，设计团队尽可能地购买IP而不是自己开发可重用模块，除非是产品的特色功能。但是由于第三方IP的质量并不能得到可靠的保证，这种在规划阶段便考虑好的外部购买IP可能会在着手设计的阶段遇到问题。大多数使用过第三方IP的设计团队都至少有一些糟糕的经历，一般都是错误的功能和稀烂的文档。但是有一些第三方IP供应商一直在提供高质量IP，这可以极大的缩短SoC的设计周期。处理器设计大厂已经成功地将他们的core放进越来越多的设计中，甚至可以和内部开发的处理器竞争。（还有这段时期吗？肯定是买core更稳妥吧？）

由于在构架阶段考虑购买IP，但是真正高质量IP又相对匮乏，最终推动了SoC设计的标准化。逐渐地，设计师从少数几个可选的处理器和总线之间做出选择来作为他们设计的基础框架。然后选择一些标准外围接口来保证最终产品的可交互性，比如PCI-X，USB，或者1394（这啥？）。因此，芯片设计中，基础结构是明确的，而最终产品差异化的部分则主要是软件或者专门的计算单元。

这种芯片设计的趋势，让人想起了早期的个人电脑，但是大量不同的架构最终只剩下两种。硬件平台的逐渐统一，使得硬件的插槽拓展和软件得以发展出一定规模。同样的，使用基于可重用设计的芯片架构也会粗催生出新的市场，包括差异化软件和高度定制和高价值硬件。
